# 后台发布功能设计方案

## 概述

本文档详细描述汪峰粉丝网站后台管理系统中的发布功能设计方案，包括文章发布、行程发布和视频发布三个模块。发布页面采用统一的专业后台管理风格，提供直观的内容创建和编辑体验。

---

## 设计原则

### 1. 统一的视觉风格
- **全屏布局**：除导航栏和侧边栏外，发布页面占据全部可用空间
- **无卡片设计**：采用扁平化设计，使用带边框的分组区域
- **汪峰紫主题色**：主题色 `#8B5CF6`（wangfeng-purple），用于强调重点元素
- **明暗主题适配**：完整支持 Light/Dark 两种主题模式

### 2. 布局原则
- **顶部固定操作栏**：返回按钮 + 标题 + 发布按钮
- **分组表单区域**：逻辑相关的字段分组展示
- **滚动策略**：
  - 视频/行程：固定高度容器，内部滚动
  - 文章：页面整体滚动（编辑器内容可增长）

### 3. 交互原则
- **即时反馈**：表单验证、上传进度、保存状态
- **清晰导航**：面包屑式返回，明确当前位置
- **防误操作**：必填字段标记，提交前验证

---

## 页面结构

### 统一布局框架

所有发布页面采用相同的布局结构：

```
┌─────────────────────────────────────────────┐
│ 1. 顶部操作栏 (flex-shrink-0)                │
│   左：返回按钮 | 分隔线 | 图标+标题          │
│   右：发布/保存按钮                          │
├─────────────────────────────────────────────┤
│ 2. 主要内容区域 (flex-1, overflow-y-auto)   │
│   - 成功/错误消息                            │
│   - 表单分组区域                             │
│     └─ 带标题的边框卡片                      │
└─────────────────────────────────────────────┘
```

### 代码结构模板

```tsx
<div className="h-full flex flex-col">
  {/* 顶部操作栏 */}
  <div className="flex-shrink-0 border-b px-6 py-4">
    <div className="flex items-center justify-between">
      <div className="flex items-center gap-4">
        <button onClick={() => navigate('/admin/xxx/list')}>
          <ArrowLeft className="h-4 w-4" />
          返回列表
        </button>
        <div className="h-5 w-px bg-gray-300" />
        <h1>
          <Icon className="h-5 w-5 text-wangfeng-purple" />
          页面标题
        </h1>
      </div>
      <button onClick={handleSubmit}>发布/保存</button>
    </div>
  </div>

  {/* 主要内容区域 */}
  <div className="flex-1 overflow-y-auto">
    <div className="max-w-7xl mx-auto px-6 py-6">
      {/* 表单内容 */}
    </div>
  </div>
</div>
```

---

## 发布页面详解

### 一、文章发布/编辑 (ArticleCreate / ArticleEdit)

#### 1. 页面标识
- **路由**：
  - 创建：`/admin/articles/create`
  - 编辑：`/admin/articles/edit/:id`
- **图标**：`Newspaper`
- **标题**：发布文章 / 编辑文章

#### 2. 布局特点

**允许页面滚动**：文章编辑器（RichTextEditor）内容会随着输入增长，页面整体可以滚动查看全部内容。

```tsx
<div className="flex-1 overflow-y-auto">
  <div className="max-w-7xl mx-auto px-6 py-6">
    {/* 基础信息区域 */}
    <div className="rounded-lg border p-6 mb-6">
      <h2>基础信息</h2>
      {/* 表单字段 */}
    </div>

    {/* 文章内容区域 */}
    <div className="rounded-lg border p-6">
      <h2>文章内容 *</h2>
      <RichTextEditor />
    </div>
  </div>
</div>
```

#### 3. 表单分组

**基础信息区域**：
```tsx
<div className="rounded-lg border p-6 mb-6">
  <h2 className="text-lg font-semibold mb-4 pb-2 border-b">
    基础信息
  </h2>
  <div className="space-y-5">
    {/* 文章标题 */}
    <div>
      <label>文章标题 *</label>
      <input type="text" required />
    </div>

    {/* 主要分类 + 次要分类 */}
    <div className="grid grid-cols-1 md:grid-cols-2 gap-5">
      <div>
        <label>主要分类 *</label>
        <select required>
          <option>峰迷聊峰</option>
          <option>峰言峰语</option>
          <option>数据科普</option>
        </select>
      </div>
      <div>
        <label>次要分类</label>
        <select>
          <option value="">无</option>
          {/* 根据主分类动态显示 */}
        </select>
      </div>
    </div>

    {/* 作者 + 发布日期 */}
    <div className="grid grid-cols-1 md:grid-cols-2 gap-5">
      <div>
        <label>作者 *</label>
        <input type="text" required />
      </div>
      <div>
        <label>发布日期 *</label>
        <input type="date" required />
      </div>
    </div>

    {/* 摘要 */}
    <div>
      <label>文章摘要（可选）</label>
      <textarea rows={3} />
    </div>

    {/* 标签 */}
    <div>
      <label>标签（可选）</label>
      <TagInputWithSearch />
    </div>
  </div>
</div>
```

**文章内容区域**：
```tsx
<div className="rounded-lg border p-6">
  <h2 className="text-lg font-semibold mb-4 pb-2 border-b">
    文章内容 *
  </h2>
  <div className="rich-text-editor-container">
    <RichTextEditor
      value={article.content}
      onChange={handleContentChange}
    />
  </div>
</div>
```

#### 4. 次要分类逻辑

**动态关联**：次要分类根据主要分类动态显示

```tsx
const secondaryCategories: Record<PrimaryCategory, string[]> = {
  '峰迷聊峰': ['深度访谈', '粉丝故事', '演出回顾', '其他'],
  '峰言峰语': ['音乐评论', '社会观察', '人生感悟', '其他'],
  '数据科普': ['统计分析', '历史回顾', '榜单解读', '其他'],
};

// 根据主分类获取次要分类选项
const getSecondaryOptions = (primary: PrimaryCategory) => {
  return secondaryCategories[primary] || [];
};
```

#### 5. 富文本编辑器

**使用组件**：`RichTextEditor`

**功能特性**：
- 格式化文本（粗体、斜体、下划线等）
- 标题层级（H1-H6）
- 列表（有序、无序）
- 链接插入
- 图片上传
- 代码块
- 引用块

**样式定制**：
```css
.rich-text-editor-container {
  min-height: 400px;
}

.rich-text-editor-container .ql-container {
  min-height: 350px;
}
```

---

### 二、行程发布/编辑 (ScheduleCreate / ScheduleEdit)

#### 1. 页面标识
- **路由**：
  - 创建：`/admin/schedules/create`
  - 编辑：`/admin/schedules/edit/:id`
- **图标**：`Calendar`
- **标题**：发布行程 / 编辑行程

#### 2. 布局特点

**3列网格布局**：
- 左侧（1/3 宽度）：图片上传区域，固定高度 500px
- 右侧（2/3 宽度）：表单区域，两个分组卡片

```tsx
<div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
  {/* 左侧：图片上传 */}
  <div className="rounded-lg border p-6">
    <h2>行程海报</h2>
    <div className="flex flex-col h-[500px]">
      {/* 图片预览或上传区域 */}
    </div>
  </div>

  {/* 右侧：表单区域 */}
  <div className="lg:col-span-2 space-y-6">
    <div className="rounded-lg border p-6">基础信息</div>
    <div className="rounded-lg border p-6">日期与详情</div>
  </div>
</div>
```

#### 3. 图片上传区域

**未上传状态**：
```tsx
<label className="flex flex-1 flex-col items-center justify-center gap-3 rounded-lg border-2 border-dashed cursor-pointer">
  <Upload className="h-12 w-12 text-gray-400" />
  <div className="text-center">
    <p className="text-sm font-medium">点击上传行程海报</p>
    <p className="text-xs mt-1">支持 JPG、PNG 格式，建议比例 2:3</p>
    <p className="text-xs">大小不超过 5MB</p>
  </div>
  <input
    type="file"
    accept="image/*"
    className="hidden"
    onChange={handleFileChange}
  />
</label>
```

**已上传状态**：
```tsx
<div className="relative flex-1">
  <div className="absolute inset-0 overflow-hidden rounded-lg border">
    <img
      src={imagePreview}
      alt="行程图片预览"
      className="h-full w-full object-cover"
    />
  </div>
  <button
    type="button"
    onClick={() => handleFileChange(null)}
    className="absolute top-2 right-2 z-10 rounded-full border p-1.5"
  >
    <X className="h-4 w-4" />
  </button>
</div>
```

**图片处理逻辑**：
```tsx
const [imageFile, setImageFile] = useState<File | null>(null);
const [imagePreview, setImagePreview] = useState<string | null>(null);

const handleFileChange = (fileList: FileList | null) => {
  // 清理旧的预览 URL
  if (imagePreview) {
    URL.revokeObjectURL(imagePreview);
    setImagePreview(null);
  }

  if (!fileList || fileList.length === 0) {
    setImageFile(null);
    return;
  }

  const file = fileList[0];
  setImageFile(file);
  const previewUrl = URL.createObjectURL(file);
  setImagePreview(previewUrl);
};

// 清理预览图片
useEffect(() => {
  return () => {
    if (imagePreview) {
      URL.revokeObjectURL(imagePreview);
    }
  };
}, [imagePreview]);
```

#### 4. 表单分组

**基础信息区域**：
```tsx
<div className="rounded-lg border p-6">
  <h2 className="text-lg font-semibold mb-4 pb-2 border-b">
    基础信息
  </h2>
  <div className="space-y-5">
    {/* 行程主题 */}
    <div>
      <label>
        <FileText className="inline h-4 w-4 mr-1.5 -mt-0.5" />
        行程主题 *
      </label>
      <input
        type="text"
        placeholder='例如：汪峰"相信未来"巡回演唱会'
        required
      />
    </div>

    {/* 行程分类 + 所在城市 */}
    <div className="grid grid-cols-1 md:grid-cols-2 gap-5">
      <div>
        <label>
          <Tag className="inline h-4 w-4 mr-1.5 -mt-0.5" />
          行程分类 *
        </label>
        <select required>
          <option>演唱会</option>
          <option>Livehouse</option>
          <option>音乐节</option>
          {/* ... 其他分类 */}
        </select>
      </div>
      <div>
        <label>
          <MapPin className="inline h-4 w-4 mr-1.5 -mt-0.5" />
          所在城市 *
        </label>
        <input type="text" placeholder="例如：北京" required />
      </div>
    </div>

    {/* 具体场馆 */}
    <div>
      <label>具体场馆 / 地点</label>
      <input type="text" placeholder="例如：北京工人体育馆" />
    </div>
  </div>
</div>
```

**日期与详情区域**：
```tsx
<div className="rounded-lg border p-6">
  <h2 className="text-lg font-semibold mb-4 pb-2 border-b">
    日期与详情
  </h2>
  <div className="space-y-5">
    {/* 行程日期（三联选择器） */}
    <div>
      <label>
        <Calendar className="inline h-4 w-4 mr-1.5 -mt-0.5" />
        行程日期 *
      </label>
      <div className="grid grid-cols-3 gap-3">
        <select>{/* 年份 */}</select>
        <select>{/* 月份 */}</select>
        <select>{/* 日期 */}</select>
      </div>
    </div>

    {/* 补充说明 */}
    <div>
      <label>补充说明（可选）</label>
      <textarea
        rows={4}
        placeholder="填写更多行程细节、嘉宾信息等"
      />
    </div>

    {/* 标签 */}
    <div>
      <label>标签（可选）</label>
      <TagInputWithSearch />
    </div>
  </div>
</div>
```

#### 5. 日期选择器实现

**状态管理**：
```tsx
const [selectedDate, setSelectedDate] = useState({
  year: new Date().getFullYear(),
  month: new Date().getMonth() + 1,
  day: new Date().getDate()
});

// 生成年份选项（1971年到2071年）
const years = Array.from({ length: 101 }, (_, i) => 1971 + i);
const months = Array.from({ length: 12 }, (_, i) => i + 1);

// 根据年份和月份生成日期选项
const getDaysInMonth = (year: number, month: number) => {
  return new Date(year, month, 0).getDate();
};

const days = Array.from(
  { length: getDaysInMonth(selectedDate.year, selectedDate.month) },
  (_, i) => i + 1
);
```

**同步到表单**：
```tsx
useEffect(() => {
  const formattedDate = `${selectedDate.year}-${String(selectedDate.month).padStart(2, '0')}-${String(selectedDate.day).padStart(2, '0')}`;
  setFormState(prev => ({ ...prev, date: formattedDate }));
}, [selectedDate]);
```

**更新选中日期**：
```tsx
const updateSelectedDate = (field: 'year' | 'month' | 'day', value: number) => {
  setSelectedDate(prev => {
    const newDate = { ...prev, [field]: value };
    const daysInMonth = getDaysInMonth(newDate.year, newDate.month);
    // 防止日期超出当月天数（如 2月31日）
    if (field !== 'day' && newDate.day > daysInMonth) {
      newDate.day = daysInMonth;
    }
    return newDate;
  });
};
```

---

### 三、视频发布 (VideoCreate)

#### 1. 页面标识
- **路由**：`/admin/videos/create`
- **图标**：`Video`
- **标题**：发布视频

#### 2. 布局特点

**固定高度容器，内部滚动**：
```tsx
<div className="flex-1 overflow-y-auto">
  <div className="max-w-5xl mx-auto px-6 py-6">
    {/* 表单内容 */}
  </div>
</div>
```

#### 3. 表单分组

**基础信息区域**：
```tsx
<div className="rounded-lg border p-6 mb-6">
  <h2 className="text-lg font-semibold mb-4 pb-2 border-b">
    基础信息
  </h2>
  <div className="space-y-5">
    {/* 视频标题 */}
    <div>
      <label>视频标题 *</label>
      <input type="text" required />
    </div>

    {/* 视频 URL */}
    <div>
      <label>视频 URL *</label>
      <input
        type="url"
        placeholder="https://www.youtube.com/watch?v=..."
        required
      />
    </div>

    {/* 封面图 URL */}
    <div>
      <label>封面图 URL</label>
      <input
        type="url"
        placeholder="https://example.com/image.jpg"
      />
    </div>

    {/* 视频描述 */}
    <div>
      <label>视频描述（可选）</label>
      <textarea rows={4} />
    </div>
  </div>
</div>
```

**分类与日期区域**：
```tsx
<div className="rounded-lg border p-6">
  <h2 className="text-lg font-semibold mb-4 pb-2 border-b">
    分类与日期
  </h2>
  <div className="space-y-5">
    {/* 视频分类 */}
    <div>
      <label>视频分类 *</label>
      <select required>
        <option>演唱会</option>
        <option>现场表演</option>
        <option>访谈</option>
        <option>MV</option>
        <option>其他</option>
      </select>
    </div>

    {/* 发布日期 */}
    <div>
      <label>发布日期 *</label>
      <input type="date" required />
    </div>
  </div>
</div>
```

---

## 通用功能组件

### 1. 标签输入组件 (TagInputWithSearch)

**功能特性**：
- 搜索现有标签
- 创建新标签
- 添加/移除标签
- 显示已选标签列表

**使用示例**：
```tsx
import TagInputWithSearch from '@/components/ui/TagInputWithSearch';

<TagInputWithSearch
  selectedTags={formState.tags}
  onAddTag={handleAddTag}
  onRemoveTag={handleRemoveTag}
  onSearchTags={handleSearchTags}
  onCreateTag={handleCreateTag}
  placeholder="搜索或创建标签..."
/>
```

**处理函数**：
```tsx
const handleAddTag = (tag: TagData) => {
  if (!formState.tags.some(t => t.id === tag.id)) {
    setFormState(prev => ({
      ...prev,
      tags: [...prev.tags, tag]
    }));
  }
};

const handleRemoveTag = (tagId: number) => {
  setFormState(prev => ({
    ...prev,
    tags: prev.tags.filter(tag => tag.id !== tagId)
  }));
};

const handleSearchTags = async (query: string): Promise<TagData[]> => {
  try {
    return await tagAPI.search(query);
  } catch (error) {
    console.error('搜索标签失败:', error);
    return [];
  }
};

const handleCreateTag = async (name: string): Promise<TagData> => {
  try {
    return await tagAPI.create(name);
  } catch (error) {
    console.error('创建标签失败:', error);
    throw error;
  }
};
```

### 2. 富文本编辑器 (RichTextEditor)

**使用示例**：
```tsx
import RichTextEditor from '@/components/ui/RichTextEditor';

<RichTextEditor
  value={article.content}
  onChange={handleContentChange}
/>
```

**处理函数**：
```tsx
const handleContentChange = (content: string) => {
  setArticle(prev => ({
    ...prev,
    content
  }));
};
```

---

## 表单验证

### 1. 必填字段标记

**视觉标记**：
```tsx
<label>
  文章标题 <span className="text-red-500">*</span>
</label>
```

**HTML 验证**：
```tsx
<input type="text" required />
<select required></select>
<textarea required></textarea>
```

### 2. 提交前验证

**客户端验证**：
```tsx
const handleSubmit = async (event: FormEvent<HTMLFormElement>) => {
  event.preventDefault();

  // 使用浏览器原生验证
  if (!event.currentTarget.checkValidity()) {
    return;
  }

  setSubmitting(true);
  // ... 提交逻辑
};
```

**自定义验证**：
```tsx
const validateForm = (): string | null => {
  if (!formState.title.trim()) {
    return '标题不能为空';
  }
  if (formState.title.length > 200) {
    return '标题不能超过 200 个字符';
  }
  if (!formState.content.trim()) {
    return '内容不能为空';
  }
  return null;
};

const handleSubmit = async (event: FormEvent<HTMLFormElement>) => {
  event.preventDefault();

  const error = validateForm();
  if (error) {
    setError(error);
    return;
  }

  // ... 提交逻辑
};
```

---

## 消息反馈

### 1. 成功消息

**显示时机**：提交成功后

**设计样式**：
```tsx
{success && (
  <div className={cn(
    "rounded-lg border p-4 flex items-start gap-3 mb-6",
    isLight
      ? "bg-green-50 border-green-200 text-green-800"
      : "bg-green-500/10 border-green-500/30 text-green-300"
  )}>
    <CheckCircle2 className="h-5 w-5 flex-shrink-0 mt-0.5" />
    <span className="text-sm">{success}</span>
  </div>
)}
```

**自动跳转**：
```tsx
const handleSubmit = async (event: FormEvent<HTMLFormElement>) => {
  // ... 提交逻辑

  setSuccess('文章发布成功！');

  setTimeout(() => {
    navigate('/admin/articles/list', {
      replace: false,
      state: { highlightId: created.id },
    });
  }, 1200);
};
```

### 2. 错误消息

**显示时机**：提交失败或验证失败

**设计样式**：
```tsx
{error && (
  <div className={cn(
    "rounded-lg border p-4 flex items-start gap-3 mb-6",
    isLight
      ? "bg-red-50 border-red-200 text-red-800"
      : "bg-red-500/10 border-red-500/30 text-red-300"
  )}>
    <AlertCircle className="h-5 w-5 flex-shrink-0 mt-0.5" />
    <span className="text-sm">{error}</span>
  </div>
)}
```

**错误处理**：
```tsx
try {
  await articleAPI.create(payload, token);
  setSuccess('文章发布成功！');
} catch (err) {
  setError(err instanceof Error ? err.message : '发布失败，请稍后重试');
} finally {
  setSubmitting(false);
}
```

---

## 提交逻辑

### 1. 文章提交

**JSON 提交**：
```tsx
const handleSubmit = async (event: FormEvent<HTMLFormElement>) => {
  event.preventDefault();
  setSubmitting(true);

  try {
    const payload = {
      title: article.title,
      content: article.content,
      category_primary: article.category_primary,
      category_secondary: article.category_secondary || null,
      author: article.author,
      published_at: article.published_at,
      summary: article.summary || '',
      tags: article.tags.map(t => t.name).join(','),
    };

    await articleAPI.create(payload, token);
    setSuccess('文章发布成功！');

    // 跳转到列表页
    setTimeout(() => {
      navigate('/admin/articles/list');
    }, 1200);
  } catch (err) {
    setError(err instanceof Error ? err.message : '发布失败');
  } finally {
    setSubmitting(false);
  }
};
```

### 2. 行程提交

**FormData 提交（含文件）**：
```tsx
const handleSubmit = async (event: FormEvent<HTMLFormElement>) => {
  event.preventDefault();
  setSubmitting(true);

  try {
    const payload = new FormData();
    payload.append('category', formState.category);
    payload.append('date', formState.date);
    payload.append('city', formState.city);
    payload.append('venue', formState.venue);
    payload.append('theme', formState.theme);
    payload.append('description', formState.description);

    if (formState.tags.length > 0) {
      payload.append('tags', formState.tags.map(t => t.name).join(','));
    }

    if (imageFile) {
      payload.append('image', imageFile);
    }

    await scheduleAPI.create(payload, token);
    setSuccess('行程发布成功！');

    setTimeout(() => {
      navigate('/admin/schedules/list');
    }, 1200);
  } catch (err) {
    setError(err instanceof Error ? err.message : '发布失败');
  } finally {
    setSubmitting(false);
  }
};
```

### 3. 视频提交

**JSON 提交**：
```tsx
const handleSubmit = async (event: FormEvent<HTMLFormElement>) => {
  event.preventDefault();
  setSubmitting(true);

  try {
    const payload = {
      title: video.title,
      url: video.url,
      thumbnail: video.thumbnail || '',
      description: video.description || '',
      category: video.category,
      published_at: video.published_at,
    };

    await videoAPI.create(payload, token);
    setSuccess('视频发布成功！');

    setTimeout(() => {
      navigate('/admin/videos/list');
    }, 1200);
  } catch (err) {
    setError(err instanceof Error ? err.message : '发布失败');
  } finally {
    setSubmitting(false);
  }
};
```

---

## 编辑功能（Update）

### 1. 数据加载

**从 URL 参数获取 ID**：
```tsx
import { useParams } from 'react-router-dom';

const { id } = useParams<{ id: string }>();
```

**加载现有数据**：
```tsx
useEffect(() => {
  if (!id) {
    setError('缺少文章ID');
    setLoading(false);
    return;
  }

  const loadArticle = async () => {
    try {
      const data = await articleAPI.getById(parseInt(id));

      // 设置表单状态
      setArticle({
        title: data.title,
        content: data.content,
        category_primary: data.category_primary,
        category_secondary: data.category_secondary || '',
        author: data.author,
        published_at: data.published_at,
        summary: data.summary || '',
        tags: data.tags || [],
      });
    } catch (err) {
      console.error('加载文章失败:', err);
      setError('加载文章数据失败');
    } finally {
      setLoading(false);
    }
  };

  loadArticle();
}, [id]);
```

### 2. 加载状态显示

```tsx
if (loading) {
  return (
    <div className="h-full flex items-center justify-center">
      <div className="flex flex-col items-center gap-4">
        <Loader2 className="h-12 w-12 animate-spin text-wangfeng-purple" />
        <p className="text-sm text-gray-600">加载数据...</p>
      </div>
    </div>
  );
}
```

### 3. 更新提交

**调用更新 API**：
```tsx
const handleSubmit = async (event: FormEvent<HTMLFormElement>) => {
  event.preventDefault();
  if (!id) return;

  setSubmitting(true);

  try {
    await articleAPI.update(parseInt(id), payload, token);
    setSuccess('文章更新成功！');

    setTimeout(() => {
      navigate('/admin/articles/list');
    }, 1200);
  } catch (err) {
    setError(err instanceof Error ? err.message : '更新失败');
  } finally {
    setSubmitting(false);
  }
};
```

---

## 主题适配

### Light Mode

**配色方案**：
```tsx
const lightColors = {
  background: 'bg-gray-50',
  cardBg: 'bg-white',
  border: 'border-gray-200',
  text: 'text-gray-900',
  textSecondary: 'text-gray-700',
  inputBg: 'bg-white',
  inputBorder: 'border-gray-300',
  placeholderText: 'placeholder:text-gray-400',
};
```

### Dark Mode

**配色方案**：
```tsx
const darkColors = {
  background: 'bg-black',
  cardBg: 'bg-black/40',
  border: 'border-wangfeng-purple/20',
  text: 'text-white',
  textSecondary: 'text-gray-300',
  inputBg: 'bg-black/50',
  inputBorder: 'border-wangfeng-purple/30',
  placeholderText: 'placeholder:text-gray-500',
};
```

### 使用示例

```tsx
import { useTheme } from '@/contexts/ThemeContext';
import { cn } from '@/lib/utils';

const { theme } = useTheme();
const isLight = theme === 'white';

<input
  type="text"
  className={cn(
    "w-full rounded-lg border px-4 py-2.5 text-sm transition-colors focus:outline-none focus:ring-2",
    isLight
      ? "bg-white border-gray-300 text-gray-900 placeholder:text-gray-400 focus:border-wangfeng-purple focus:ring-wangfeng-purple/20"
      : "bg-black/50 border-wangfeng-purple/30 text-gray-200 placeholder:text-gray-500 focus:border-wangfeng-purple focus:ring-wangfeng-purple/20"
  )}
/>
```

---

## 响应式设计

### 1. 表单网格布局

**两列布局在大屏幕，单列在小屏幕**：
```tsx
<div className="grid grid-cols-1 md:grid-cols-2 gap-5">
  <div>{/* 字段 1 */}</div>
  <div>{/* 字段 2 */}</div>
</div>
```

### 2. 行程页面布局

**三列布局在大屏幕，单列在小屏幕**：
```tsx
<div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
  <div>{/* 图片上传 */}</div>
  <div className="lg:col-span-2">{/* 表单区域 */}</div>
</div>
```

### 3. 内容区域最大宽度

**防止内容在大屏幕上过宽**：
```tsx
<div className="max-w-7xl mx-auto px-6 py-6">
  {/* 内容 */}
</div>
```

---

## 交互细节

### 1. 按钮禁用状态

**提交中禁用按钮**：
```tsx
<button
  onClick={handleSubmit}
  disabled={submitting}
  className="px-5 py-2 bg-wangfeng-purple text-white rounded-lg hover:bg-wangfeng-purple/90 disabled:opacity-50 disabled:cursor-not-allowed"
>
  {submitting ? '发布中...' : '发布文章'}
</button>
```

### 2. 表单提交触发

**从外部按钮触发表单提交**：
```tsx
<button
  onClick={(e) => {
    e.preventDefault();
    const form = document.querySelector('form') as HTMLFormElement;
    if (form) form.requestSubmit();
  }}
  disabled={submitting}
>
  {submitting ? '发布中...' : '发布文章'}
</button>
```

### 3. 返回导航

**返回列表页面**：
```tsx
<button
  onClick={() => navigate('/admin/articles/list')}
  className="flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium hover:bg-gray-100"
>
  <ArrowLeft className="h-4 w-4" />
  返回列表
</button>
```

---

## 文件组织

```
frontend/src/components/admin/pages/
├── ArticleCreate.tsx        # 文章创建页面
├── ArticleEdit.tsx          # 文章编辑页面
├── ScheduleCreate.tsx       # 行程创建页面
├── ScheduleEdit.tsx         # 行程编辑页面
├── VideoCreate.tsx          # 视频创建页面
└── ... 其他页面

frontend/src/components/ui/
├── RichTextEditor.tsx       # 富文本编辑器
├── TagInputWithSearch.tsx   # 标签输入组件
└── ... 其他 UI 组件
```

---

## API 集成

### 1. API 工具函数

**位置**：`frontend/src/utils/api.ts`

**文章 API**：
```tsx
export const articleAPI = {
  create: async (data: ArticleCreateData, token: string): Promise<Article> => {
    const response = await fetch(`${API_BASE_URL}/articles`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`,
      },
      body: JSON.stringify(data),
    });
    return response.json();
  },

  update: async (id: number, data: ArticleUpdateData, token: string): Promise<Article> => {
    const response = await fetch(`${API_BASE_URL}/articles/${id}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`,
      },
      body: JSON.stringify(data),
    });
    return response.json();
  },

  getById: async (id: number): Promise<Article> => {
    const response = await fetch(`${API_BASE_URL}/articles/${id}`);
    return response.json();
  },
};
```

**行程 API**（支持文件上传）：
```tsx
export const scheduleAPI = {
  create: async (data: FormData, token: string): Promise<Schedule> => {
    const response = await fetch(`${API_BASE_URL}/schedules`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
      },
      body: data, // FormData 自动设置 Content-Type
    });
    return response.json();
  },
};
```

### 2. 认证集成

**从 AuthContext 获取 token**：
```tsx
import { useAuth } from '@/contexts/AuthContext';

const { token } = useAuth();

// 在 API 调用中使用
await articleAPI.create(payload, token);
```

---

## 最佳实践

### 1. 状态管理
- ✅ 使用 TypeScript 类型定义表单状态
- ✅ 统一的状态更新函数
- ✅ 清理副作用（如图片预览 URL）

### 2. 错误处理
- ✅ 捕获并显示所有错误
- ✅ 区分客户端验证和服务器错误
- ✅ 提供友好的错误提示

### 3. 用户体验
- ✅ 即时反馈（成功/错误消息）
- ✅ 提交中禁用按钮，防止重复提交
- ✅ 成功后自动跳转到列表页

### 4. 代码质量
- ✅ 组件拆分合理
- ✅ 复用通用组件（TagInputWithSearch、RichTextEditor）
- ✅ 一致的样式处理
- ✅ 清晰的注释

---

## 总结

本设计方案实现了：
- ✅ 统一的专业后台管理风格
- ✅ 完整的创建和编辑功能
- ✅ 丰富的表单组件和验证
- ✅ 完善的错误处理和用户反馈
- ✅ 良好的主题适配和响应式设计

通过遵循本设计方案，可以快速开发出风格统一、功能完备的发布页面。
