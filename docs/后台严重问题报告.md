# 后台严重问题报告

> 更新时间：`2025-01-05`

## 1. 文章更新/删除接口缺乏权限校验
- **位置**：`backend/app/routers/articles.py`
- **表现**：`PUT /api/articles/{id}` 与 `DELETE /api/articles/{id}` 未依赖 `require_admin` 或作者身份验证。
- **影响**：任何未认证用户都能直接修改或删除后台文章，属于严重安全漏洞。
- **建议**：为两个路由添加 `current_user: User = Depends(require_admin)`，或在 CRUD 层校验请求者是否为文章作者。

## 2. 前后端角色策略不一致
- **前端**：`frontend/src/App.tsx` 允许 `user` 角色进入 `/admin/articles|videos|gallery/*` 创建上传界面。
- **后端**：对应接口（文章、视频、图库创建）全部依赖 `require_admin`。
- **影响**：普通用户看到按钮和表单却必然收到 403，引发大量无效请求。
- **建议**：二选一——
  1. 前端限制按钮/路由仅管理员可见；
  2. 后端降级权限，允许普通用户提交并进入审核流。

## 3. 管理端视频列表类型定义错误
- **位置**：`frontend/src/components/admin/pages/AllVideoList.tsx`
- **表现**：组件使用 `VideoData` 类型承接 `/videos/all` 返回值，但筛选与状态展示依赖 `review_status`、`is_published` 等仅存在于 `Video` 类型的字段。
- **影响**：TypeScript 类型与真实数据不匹配，隐藏潜在运行时错误。
- **建议**：改用 `Video` 类型，或扩展 `VideoData` 定义补齐字段。

## 4. 视频分类枚举不一致
- **位置**：`MyVideoList.tsx`（以及创建/筛选相关组件）
- **表现**：前端枚举值如 “音乐录影带”“综艺影视” 与后端 `VideoCategory` 中的 `"歌曲mv"`, `"综艺节目"` 等不一致。
- **影响**：筛选条件永远匹配不到真实数据，新建视频时可能因非法分类被后端拒绝。
- **建议**：将枚举集中维护在共享配置（如 `config/videoCategories.ts`），前后端共用同一套枚举常量。

## 5. “我的内容”误显示历史公共数据
- **视频**：`backend/app/crud/video.py#get_videos_by_author`
- **图库**：`backend/app/crud/gallery.py#get_photo_groups_by_author`
- **表现**：为兼容旧数据，查询条件包含 `author_id IS NULL`。
- **影响**：任何用户都会在“我的视频/图组”里看到所有未标记作者的历史数据，导致越权浏览。
- **建议**：编写一次性迁移脚本为遗留数据补齐 `author_id`，并移除 `IS NULL` 容忍；或仅在管理员视图中包含 NULL 项。

---

请按照严重程度优先处理安全漏洞（问题 1、5），随后统一权限策略与枚举配置。处理完毕后建议回归测试后台上传、审核、筛选等流程。
