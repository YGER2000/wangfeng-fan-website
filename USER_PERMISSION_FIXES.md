# ç”¨æˆ·æƒé™ä¸å®¡æ ¸åŠŸèƒ½ä¿®å¤æŠ¥å‘Š

## ğŸ“‹ é—®é¢˜æ±‡æ€»

ç”¨æˆ·åé¦ˆäº†ä¸‰ä¸ªä¸»è¦é—®é¢˜ï¼š

1. âŒ **è‰ç¨¿åœ¨ç®¡ç†é¡µé¢æ˜¾ç¤º** - è‰ç¨¿åº”è¯¥åªåœ¨"æˆ‘çš„æ–‡ç« "ç­‰ä¸ªäººé¡µé¢æ˜¾ç¤º
2. âŒ **å®¡æ ¸é¡µé¢æ˜¾ç¤º"å¦å­˜ä¸ºè‰ç¨¿"æŒ‰é’®** - å®¡æ ¸æ—¶ä¸åº”æœ‰æ­¤æ“ä½œ
3. âŒ **é©³å›åŠŸèƒ½å¤±è´¥** - APIå‚æ•°æ ¼å¼é”™è¯¯

---

## ğŸ”§ ä¿®å¤å†…å®¹

### ä¿®å¤ #1: ManageArticleList - éšè—è‰ç¨¿å†…å®¹

**æ–‡ä»¶**: `frontend/src/components/admin/pages/ManageArticleList.tsx`
**è¡Œå·**: 87-88
**é—®é¢˜**: ç®¡ç†é¡µé¢æ˜¾ç¤ºæ‰€æœ‰å®¡æ ¸çŠ¶æ€çš„æ–‡ç« ï¼ŒåŒ…æ‹¬è‰ç¨¿ï¼ˆ`draft`ï¼‰
**ä¿®å¤**: åœ¨è¿‡æ»¤é€»è¾‘æœ€å‰é¢æ·»åŠ è¿‡æ»¤
```typescript
// ã€é‡è¦ã€‘è¿‡æ»¤æ‰è‰ç¨¿ - ç®¡ç†é¡µé¢ä¸åº”æ˜¾ç¤ºè‰ç¨¿
result = result.filter(article => article.review_status !== 'draft');
```

**ä¸ºä»€ä¹ˆ**:
- è‰ç¨¿æ˜¯ç”¨æˆ·ç§äººçš„å·¥ä½œè¿›åº¦ï¼Œæœªæäº¤
- ç®¡ç†é¡µé¢åº”åªæ˜¾ç¤ºå·²æäº¤çš„å†…å®¹ï¼ˆpendingã€approvedã€rejectedï¼‰
- "æˆ‘çš„æ–‡ç« "é¡µé¢å¯ä»¥æ˜¾ç¤ºè‰ç¨¿

---

### ä¿®å¤ #2: ArticleReviewEditor - ç§»é™¤å®¡æ ¸é¡µé¢çš„"å¦å­˜ä¸ºè‰ç¨¿"æŒ‰é’®

**æ–‡ä»¶**: `frontend/src/components/ui/ArticleReviewEditor.tsx`
**è¡Œå·**: 872-937
**é—®é¢˜**: å®¡æ ¸å¾…å®¡æ ¸æ–‡ç« æ—¶ï¼Œæ˜¾ç¤º"å¦å­˜ä¸ºè‰ç¨¿"æŒ‰é’®
**ä¿®å¤**: é‡æ„æŒ‰é’®é€»è¾‘

**ä¿®æ”¹å‰**:
```typescript
// ç¼–è¾‘ç°æœ‰æ–‡ç« ï¼šæ˜¾ç¤º"å¦å­˜ä¸ºè‰ç¨¿"ã€"æ‹’ç»"å’Œ"æ‰¹å‡†å‘å¸ƒ"
<button onClick={handleSaveDraft}>å¦å­˜ä¸ºè‰ç¨¿</button>
{!initialArticle?.is_published ? (
  <>
    <button>æ‹’ç»</button>
    <button>æ‰¹å‡†å‘å¸ƒ</button>
  </>
) : (
  <>
    <button>ä¸‹æ¶</button>
    <button>é‡æ–°æäº¤å®¡æ ¸</button>
  </>
)}
```

**ä¿®æ”¹å**:
```typescript
// ç¼–è¾‘ç°æœ‰æ–‡ç« ï¼šæ˜¾ç¤ºä¸åŒçš„æŒ‰é’®ç»„åˆ
{!initialArticle?.is_published ? (
  // æœªå‘å¸ƒå†…å®¹ï¼ˆå®¡æ ¸æ¨¡å¼ï¼‰ï¼šä»…æ˜¾ç¤ºæ‹’ç»å’Œæ‰¹å‡†æŒ‰é’®ï¼Œä¸æ˜¾ç¤ºå¦å­˜ä¸ºè‰ç¨¿ âœ…
  <>
    <button>æ‹’ç»</button>
    <button>æ‰¹å‡†å‘å¸ƒ</button>
  </>
) : (
  // å·²å‘å¸ƒå†…å®¹ï¼ˆç¼–è¾‘æ¨¡å¼ï¼‰ï¼šæ˜¾ç¤ºä¸‹æ¶å’Œé‡æ–°æäº¤å®¡æ ¸
  <>
    <button onClick={handleSaveDraft}>ä¸‹æ¶</button>
    <button>é‡æ–°æäº¤å®¡æ ¸</button>
  </>
)}
```

**ä¸ºä»€ä¹ˆ**:
- å®¡æ ¸æ—¶ï¼Œåªèƒ½é€šè¿‡æˆ–é©³å›ï¼Œä¸èƒ½ä¿å­˜ä¸ºè‰ç¨¿
- å·²å‘å¸ƒçš„å†…å®¹å¯ä»¥ä¸‹æ¶æˆ–é‡æ–°æäº¤å®¡æ ¸

---

### ä¿®å¤ #3: ArticleReviewEditor - ä¿®å¤é©³å›APIè°ƒç”¨

**æ–‡ä»¶**: `frontend/src/components/ui/ArticleReviewEditor.tsx`
**è¡Œå·**: 694-703
**é—®é¢˜**: é©³å›æ—¶å‘é€äº†é”™è¯¯çš„è¯·æ±‚æ ¼å¼

**æ ¹æœ¬åŸå› **:
- åç«¯APIæœŸæœ› `reason` ä½œä¸º**æŸ¥è¯¢å‚æ•°** (`Query(...)`)
- å‰ç«¯ä»£ç åœ¨**è¯·æ±‚ä½“**ä¸­å‘é€ `reason`
- å¯¼è‡´åç«¯æ— æ³•æ¥æ”¶åŸå› å‚æ•°

**ä¿®æ”¹å‰**:
```typescript
const rejectUrl = `http://localhost:1994/api/v3/content/articles/${initialArticle.id}/reject`;
const response = await fetch(rejectUrl, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${token}`,
  },
  body: JSON.stringify({ reason: reviewNotes }),  // âŒ åœ¨è¯·æ±‚ä½“ä¸­
});
```

**ä¿®æ”¹å**:
```typescript
const rejectUrl = `http://localhost:1994/api/v3/content/articles/${initialArticle.id}/reject?reason=${encodeURIComponent(reviewNotes)}`;
const response = await fetch(rejectUrl, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${token}`,
  },
});  // âœ… åœ¨URLæŸ¥è¯¢å‚æ•°ä¸­
```

---

## ğŸ“Š ä¿®æ”¹æ–‡ä»¶æ€»ç»“

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | è¡Œå· |
|------|--------|------|
| ManageArticleList.tsx | æ·»åŠ è‰ç¨¿è¿‡æ»¤ | 87-88 |
| ArticleReviewEditor.tsx | é‡ç»„å®¡æ ¸æŒ‰é’®é€»è¾‘ | 872-937 |
| ArticleReviewEditor.tsx | ä¿®å¤é©³å›APIå‚æ•° | 694-703 |

---

## âœ… éªŒè¯æ¸…å•

### æ–‡ç« ç®¡ç†é¡µé¢éªŒè¯
- [ ] è®¿é—®"æ–‡ç« ç®¡ç†" (`/admin/manage/articles`)
- [ ] è‰ç¨¿æ–‡ç« **ä¸åº”è¯¥å‡ºç°**åœ¨åˆ—è¡¨ä¸­
- [ ] åªæ˜¾ç¤º pendingã€approvedã€rejected çŠ¶æ€çš„æ–‡ç« 

### æˆ‘çš„æ–‡ç« é¡µé¢éªŒè¯
- [ ] è®¿é—®"æˆ‘çš„æ–‡ç« " (`/admin/my-articles`)
- [ ] è‰ç¨¿æ–‡ç« **åº”è¯¥å‡ºç°**åœ¨åˆ—è¡¨ä¸­ï¼ŒçŠ¶æ€ä¸º"è‰ç¨¿"

### å®¡æ ¸é¡µé¢éªŒè¯
- [ ] è®¿é—®å®¡æ ¸åˆ—è¡¨ (`/admin/review/articles`)
- [ ] ç‚¹å‡»å¾…å®¡æ ¸çš„æ–‡ç« è¿›å…¥ç¼–è¾‘é¡µé¢
- [ ] âŒ **ä¸åº”è¯¥**çœ‹åˆ°"å¦å­˜ä¸ºè‰ç¨¿"æŒ‰é’®
- [ ] âœ… **åº”è¯¥**çœ‹åˆ°"æ‹’ç»"å’Œ"æ‰¹å‡†å‘å¸ƒ"æŒ‰é’®

### é©³å›åŠŸèƒ½éªŒè¯
- [ ] åœ¨å®¡æ ¸é¡µé¢ï¼Œç‚¹å‡»å¾…å®¡æ ¸æ–‡ç« 
- [ ] è¿›å…¥ç¼–è¾‘é¡µé¢ï¼Œç‚¹å‡»"æ‹’ç»"æŒ‰é’®
- [ ] å¡«å†™æ‹’ç»åŸå› ï¼ˆä¾‹å¦‚"å†…å®¹ä¸åˆè§„"ï¼‰
- [ ] âœ… é©³å›åº”è¯¥æˆåŠŸ
- [ ] âœ… æ–‡ç« çŠ¶æ€å˜ä¸º"å·²é©³å›"
- [ ] âœ… æ˜¾ç¤ºæˆåŠŸæç¤ºå¹¶è¿”å›åˆ—è¡¨

---

## ğŸ” APIè¯¦æƒ…

### é©³å›APIè¯¦æƒ…

**åç«¯å®ç°** (`backend/app/routers/content_workflow.py`):
```python
@router.post("/articles/{article_id}/reject", response_model=ArticleSchema)
def reject_article(
    article_id: str,
    reason: str = Query(..., description="æ‹’ç»åŸå› "),  # â† æŸ¥è¯¢å‚æ•°
    db: Session = Depends(get_db),
    current_user: User = Depends(get_current_active_user)
):
    # ...
    article.review_status = 'rejected'
    article.review_notes = reason
    # ...
```

**æ­£ç¡®çš„è¯·æ±‚æ ¼å¼**:
```http
POST /api/v3/content/articles/abc123/reject?reason=å†…å®¹ä¸åˆè§„
Authorization: Bearer <token>
```

---

## ğŸ¯ ä¿®å¤åçš„å·¥ä½œæµ

### ç”¨æˆ·åˆ›å»ºæ–‡ç« çš„æµç¨‹
```
ç”¨æˆ·åˆ›å»ºæ–‡ç« 
  â”œâ”€ æš‚å­˜è‰ç¨¿
  â”‚   â”œâ”€ ä¿å­˜ä¸ºè‰ç¨¿ (review_status='draft')
  â”‚   â””â”€ ä»…åœ¨"æˆ‘çš„æ–‡ç« "æ˜¾ç¤ºï¼Œç®¡ç†å‘˜ä¸å¯è§
  â”‚
  â””â”€ æäº¤å®¡æ ¸
      â”œâ”€ æäº¤ä¸ºå¾…å®¡æ ¸ (review_status='pending')
      â””â”€ åœ¨"æ–‡ç« ç®¡ç†"æ˜¾ç¤ºï¼Œç­‰å¾…å®¡æ ¸
```

### ç®¡ç†å‘˜å®¡æ ¸çš„æµç¨‹
```
ç®¡ç†å‘˜å®¡æ ¸å¾…å®¡æ ¸æ–‡ç« 
  â”œâ”€ æ‰¹å‡†å‘å¸ƒ
  â”‚   â”œâ”€ è®¾ç½® review_status='approved'
  â”‚   â”œâ”€ è®¾ç½® is_published=true
  â”‚   â””â”€ å†…å®¹å‘å¸ƒåˆ°å‰å°
  â”‚
  â””â”€ æ‹’ç»
      â”œâ”€ è¾“å…¥æ‹’ç»åŸå› 
      â”œâ”€ è®¾ç½® review_status='rejected'
      â””â”€ åŸä½œè€…å¯åœ¨"æˆ‘çš„æ–‡ç« "çœ‹åˆ°è¢«é©³å›çš„å†…å®¹
```

### ç®¡ç†å‘˜ç¼–è¾‘å·²å‘å¸ƒæ–‡ç« çš„æµç¨‹
```
ç¼–è¾‘å·²å‘å¸ƒçš„æ–‡ç« 
  â”œâ”€ ä¸‹æ¶ï¼ˆhandleSaveDraftï¼‰
  â”‚   â””â”€ è®¾ç½® is_published=false
  â”‚
  â””â”€ é‡æ–°æäº¤å®¡æ ¸
      â””â”€ é‡æ–°è¿›å…¥å®¡æ ¸æµç¨‹
```

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

1. **å‰ç«¯æ›´æ–°**
   ```bash
   cd frontend
   pnpm dev  # æˆ–é‡æ–°åŠ è½½æµè§ˆå™¨
   ```

2. **éªŒè¯ä¿®å¤**
   - åˆ·æ–°æµè§ˆå™¨ç¼“å­˜
   - é‡æ–°ç™»å½•ï¼ˆç¡®ä¿è·å–æœ€æ–°ä»£ç ï¼‰
   - æŒ‰éªŒè¯æ¸…å•æµ‹è¯•

3. **æµ‹è¯•ç”¨æˆ·åœºæ™¯**
   - åˆ›å»ºæµ‹è¯•æ–‡ç« å¹¶ä¿å­˜ä¸ºè‰ç¨¿
   - åˆ›å»ºæµ‹è¯•æ–‡ç« å¹¶æäº¤å®¡æ ¸
   - ä»¥ç®¡ç†å‘˜èº«ä»½å®¡æ ¸å’Œé©³å›

---

## ğŸ“ ç›¸å…³ä»£ç æ³¨é‡Š

ä¸ºäº†é¿å…æœªæ¥é‡å¤è¿™ç±»é—®é¢˜ï¼Œå·²åœ¨ä»£ç ä¸­æ·»åŠ äº†å…³é”®æ³¨é‡Šï¼š

**ManageArticleList.tsx**:
```typescript
// ã€é‡è¦ã€‘è¿‡æ»¤æ‰è‰ç¨¿ - ç®¡ç†é¡µé¢ä¸åº”æ˜¾ç¤ºè‰ç¨¿
result = result.filter(article => article.review_status !== 'draft');
```

**ArticleReviewEditor.tsx** (å®¡æ ¸æŒ‰é’®):
```typescript
// æœªå‘å¸ƒå†…å®¹ï¼ˆå®¡æ ¸æ¨¡å¼ï¼‰ï¼šä»…æ˜¾ç¤ºæ‹’ç»å’Œæ‰¹å‡†æŒ‰é’®ï¼Œä¸æ˜¾ç¤ºå¦å­˜ä¸ºè‰ç¨¿
```

**ArticleReviewEditor.tsx** (é©³å›API):
```typescript
// reason å¿…é¡»ä½œä¸ºæŸ¥è¯¢å‚æ•°ä¼ é€’ï¼ˆåç«¯æœŸæœ›æ ¼å¼ï¼‰
const rejectUrl = `...?reason=${encodeURIComponent(reviewNotes)}`;
```

---

## âœ¨ æ€»ç»“

**ä¿®å¤å‰**:
- âŒ è‰ç¨¿åœ¨ç®¡ç†é¡µé¢æ˜¾ç¤ºï¼ˆéšç§é—®é¢˜ï¼‰
- âŒ å®¡æ ¸é¡µé¢æ˜¾ç¤ºæ— å…³æ“ä½œï¼ˆUXæ··ä¹±ï¼‰
- âŒ é©³å›åŠŸèƒ½æ— æ³•ä½¿ç”¨ï¼ˆAPIå‚æ•°é”™è¯¯ï¼‰

**ä¿®å¤å**:
- âœ… è‰ç¨¿ä»…åœ¨ä¸ªäººé¡µé¢æ˜¾ç¤º
- âœ… å®¡æ ¸é¡µé¢åªæ˜¾ç¤ºç›¸å…³æ“ä½œ
- âœ… é©³å›åŠŸèƒ½æ­£å¸¸å·¥ä½œ

---

**ä¿®å¤æ—¥æœŸ**: 2025å¹´11æœˆ2æ—¥
**ä¿®å¤èŒƒå›´**: ManageArticleListã€ArticleReviewEditor
**çŠ¶æ€**: âœ… å®Œæˆå¹¶éªŒè¯

