# ✅ 权限系统 + 新后台 - 快速执行清单

## 📋 已完成

### 权限系统
- ✅ 权限函数已添加到 `backend/app/core/permissions.py`
- ✅ 包含 5 个核心函数：
  - `can_create_content(content_type, user)` - 创建权限
  - `can_edit_content(content, user)` - 编辑权限 ⭐ 管理员可编辑已发布
  - `can_delete_content(content, user)` - 删除权限
  - `can_review(user)` - 审核权限
  - `can_manage_users(user)` - 用户管理权限
- ✅ 文档已更新（管理员可编辑已发布内容）

---

## 🚀 即将开始

### 新后台系统开发计划

**文件**: `ADMIN_V4_DEVELOPMENT_PLAN.md`

#### 整体计划
- **时间**: 1 周
- **规模**: ~40-50 小时
- **方案**: 复用现有 UI 组件库
- **架构**: React + FastAPI + MySQL

#### 分阶段计划

| 阶段 | 内容 | 时间 | 开始日期 |
|------|------|------|---------|
| Phase 1 | 认证层 + 基础布局 | 1 天 | ? |
| Phase 2 | 内容管理 (CRUD) | 2-3 天 | ? |
| Phase 3 | 审核系统 | 2 天 | ? |
| Phase 4 | 用户管理 | 1 天 | ? |
| 测试+优化 | 完整测试 | 1 天 | ? |

---

## 📁 新后台结构

```
frontend/src/apps/admin-v4/
├── index.tsx                # 入口
├── layout/
│   ├── AdminLayout.tsx      # 主布局
│   ├── Sidebar.tsx          # 侧边栏
│   └── Header.tsx           # 顶部栏
├── pages/
│   ├── Dashboard.tsx        # 仪表板
│   ├── MyContent.tsx        # 我的内容
│   ├── ContentEditor.tsx    # 编辑器
│   ├── ReviewPanel.tsx      # 审核面板
│   ├── UserManagement.tsx   # 用户管理
│   └── Settings.tsx         # 设置
├── components/
│   ├── ContentCard.tsx
│   ├── StatusBadge.tsx
│   ├── PaginationBar.tsx
│   └── ConfirmDialog.tsx
└── hooks/
    ├── useContent.ts
    ├── useReview.ts
    └── useUsers.ts
```

---

## 🔐 权限矩阵最终版

### 关键权限

| 操作 | 游客 | 用户 | 管理员 | 超管 |
|------|------|------|--------|------|
| 创建内容 | ❌ | ✅ | ✅ | ✅ |
| 编辑自己的 | ❌ | ✅ | ✅ | ✅ |
| **编辑他人(已发布)** | ❌ | ❌ | ✅ | ✅ | ⭐ 已实现
| 删除自己的草稿 | ❌ | ✅ | ✅ | ✅ |
| 删除他人 | ❌ | ❌ | ❌ | ✅ |
| 审核 | ❌ | ❌ | ✅ | ✅ |
| 管理用户 | ❌ | ❌ | ❌ | ✅ |

---

## 📝 核心功能清单

### 内容管理
- [ ] 创建内容 → 自动 draft 状态
- [ ] 保存草稿（自动保存）
- [ ] 提交审核 → draft → pending
- [ ] 编辑内容（权限检查）
- [ ] 删除内容（仅草稿）
- [ ] 查看我的内容列表

### 审核系统
- [ ] 查看待审核列表（仅管理员）
- [ ] 批准内容 → pending → approved + published
- [ ] 拒绝内容（需要拒绝原因） → rejected
- [ ] 编辑内容（审核时，仅管理员）
- [ ] 审核日志

### 用户管理
- [ ] 查看所有用户（仅超管）
- [ ] 修改用户角色（仅超管）
- [ ] 禁用/启用用户（仅超管）
- [ ] 删除用户（仅超管）
- [ ] 重置密码（仅超管）

---

## 🎨 UI 组件复用情况

✅ **可直接复用**:
- Button, Input, Card, Dialog, Form
- Badge (改颜色用于状态)
- 富文本编辑器

⚠️ **需要新建**:
- 数据表格 (DataTable)
- 分页组件 (Pagination)
- 侧边栏导航 (Sidebar)
- 内容卡片 (ContentCard)

---

## 🔧 必要前提

### 后端
- [x] 权限函数已实现 ✅
- [ ] API 端点实现（需要）
- [ ] 数据库字段改动（需要）

### 前端
- [ ] AuthContext 需要包含 `user.role`
- [ ] 需要权限检查 hook (useAuth)
- [ ] 需要 ProtectedRoute 组件

---

## ❓ 需要确认的问题

1. **权限函数测试**: 是否需要先写测试？
2. **API 端点**: 现有的 API 端点是否需要更新？
3. **数据库字段**: 需要添加哪些字段？
   - [ ] status (draft/pending/approved/rejected)
   - [ ] created_by_id
   - [ ] rejection_reason
   - [ ] submit_time
   - [ ] reviewed_at
4. **前端登录**: 现有的登录页是否能复用？

---

## 📞 建议的开发顺序

1. **先完成后端数据库和 API**
   - 添加数据库字段
   - 实现 API 端点（使用已有的权限函数）
   - 测试权限检查

2. **再开发前端**
   - 认证层和路由保护
   - 内容管理界面
   - 审核界面
   - 用户管理界面

3. **最后集成测试**

---

## 🎯 立即可做

选择以下之一开始：

### 选项 A: 先完成后端
```
1. 添加数据库字段迁移脚本
2. 更新内容模型（articles, videos等）
3. 实现 API 端点（POST, PUT, DELETE 等）
4. 添加权限检查到端点
5. 写测试确认权限工作正常
```

### 选项 B: 先完成前端架构
```
1. 检查 AuthContext 是否有 role 字段
2. 创建 useAuth hook 和 ProtectedRoute
3. 创建 AdminLayout 和基础结构
4. 创建路由（准备接收 API）
```

### 选项 C: 并行进行
```
前端：搭建基础架构
后端：实现 API 端点
```

---

## 📊 当前进度

```
┌─────────────────────────────────────────────────┐
│ 权限系统规划              ████████████ 100%    │
│ 权限函数实现              ████████████ 100%    │
│ 文档更新                  ████████████ 100%    │
│ 新后台计划                ████████████ 100%    │
│ 后端实现                  ░░░░░░░░░░░░   0%    │
│ 前端实现                  ░░░░░░░░░░░░   0%    │
└─────────────────────────────────────────────────┘
```

---

## 🚀 下一步行动

请选择：

1. 📝 **审阅计划** - 查看详细计划后给反馈
2. 🔧 **开始后端** - 实现数据库和 API
3. 🎨 **开始前端** - 搭建基础架构
4. ❓ **提出问题** - 有任何不清楚的地方

---

**状态**: ✅ 权限系统完成，新后台计划完成，等待您的指示开始开发
